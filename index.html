<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>MapMaker</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    
    <script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" type="text/css" />
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="sidebar">
        <input type="text" id="map-title" class="map-title-input" value="Untitled City" oninput="document.title = this.value">
        <p class="version-tag">v78: Naming & Saving</p>


        <div class="control-row">
            <button class="btn-undo" onclick="undo()"><span>â†©ï¸</span> Undo</button>
            <button class="btn-redo" onclick="redo()"><span>â†ªï¸</span> Redo</button>
        </div>
        <div style="height:10px;"></div>
    
        <button id="btn-select" class="btn-select" onclick="enterSelectMode()"><span>ğŸ‘†</span> Select / Edit</button>
        <button id="btn-label" class="btn-label" onclick="activateLabelTool()"><span>ğŸ“</span> Place Label</button>
    
        <div id="road-controls" class="context-menu">
            <div class="control-label">Road Options</div>
            
            <button id="btn-curve-toggle" class="btn-mini btn-wide btn-curve" onclick="toggleLineSmoothing()">ã€°ï¸ Make Smooth</button>
            
            <div style="height:5px;"></div> <button id="btn-bridge-toggle" class="btn-mini btn-wide btn-bridge" onclick="toggleBridge()">ğŸŒ‰ Make Bridge</button>
        </div>
    
        <div id="text-controls" class="context-menu">
            <div class="control-label">Move</div>
            
            <div class="control-row row-center">
                <button class="btn-mini" onclick="nudgeLabel(0, -5)">â¬†ï¸</button>
            </div>
            
            <div class="control-row row-center">
                <button class="btn-mini" onclick="nudgeLabel(-5, 0)">â¬…ï¸</button>
                <button class="btn-mini" onclick="nudgeLabel(0, 5)">â¬‡ï¸</button>
                <button class="btn-mini" onclick="nudgeLabel(5, 0)">â¡ï¸</button>
            </div>
            
            <div class="control-label">Rotate</div>
            
            <div class="control-row row-center">
                <button class="btn-mini" onclick="rotateLabel(-15)">â†º</button>
                <button class="btn-mini" onclick="rotateLabel(15)">â†»</button>
            </div>
            
            <div class="control-row">
                <button class="btn-mini btn-wide" onclick="editLabelText()">âœ Edit Text</button>
            </div>
        </div>
    
        <div style="height:10px;"></div>
        
        <button id="tool-freeway" class="btn-freeway" onclick="startDrawing('freeway')"><span>ğŸ›£ï¸</span> Freeway</button>
        <button id="tool-ramp" class="btn-ramp" onclick="startDrawing('ramp')"><span>â¤´ï¸</span> Ramp</button>
        <button id="tool-major" class="btn-major" onclick="startDrawing('major')"><span>ğŸ™ï¸</span> Major Road</button>
        <button id="tool-minor" class="btn-minor" onclick="startDrawing('minor')"><span>ğŸ˜ï¸</span> Minor Street</button>
        
        <div class="toggle-container">
            <div style="display:flex; align-items:center; gap:5px;">
                <input type="checkbox" id="smooth-toggle" style="width:16px; height:16px;" checked>
                <label for="smooth-toggle" style="font-size:12px;">Smooth</label>
            </div>
            
            <div style="display:flex; align-items:center; gap:5px; margin-left:10px; border-left:1px solid #555; padding-left:10px;">
                <input type="checkbox" id="snap-toggle" style="width:16px; height:16px;" checked>
                <label for="snap-toggle" style="font-size:12px;">ğŸ§² Snap</label>
            </div>
        </div>
    
        <button id="btn-delete" class="btn-delete" onclick="smartDelete()"><span>ğŸ—‘ï¸</span> Delete Selected</button>
        <button class="btn-help" onclick="toggleHelp()"><span>â“</span> Open User Guide</button>
        
        <div id="debug-info">Points: 0</div>
        <div style="flex-grow:1;"></div>
    
        <button class="btn-save" onclick="downloadMap()">ğŸ’¾ Save Map</button>
        <button class="btn-load" onclick="document.getElementById('file-input').click()">ğŸ“‚ Load Map</button>
        <input type="file" id="file-input" style="display:none" onchange="loadMap(this)" accept=".geojson,.json" />
    </div>

<div id="main-content">
    <div id="help-panel">
        <button class="close-btn" onclick="toggleHelp()">âœ–</button>
        <h2>MapMaker Guide</h2>
        <p style="color:#7f8c8d; font-size:12px;">v78 â€¢ Infrastructure Engine</p>

        <h4>1. Drawing & Snapping</h4>
        <ul>
            <li><strong>ğŸ§² Snap Toggle:</strong> When ON, road ends will magnetize to other roads (Green Flash).</li>
            <li><strong>Sticky Roads:</strong> Connected roads move together. Drag a parent road to move its children.</li>
            <li><strong>Split:</strong> Connecting to the middle of a road splits it into two segments.</li>
        </ul>

        <h4>2. Road Hierarchy</h4>
        <ul>
            <li><strong>ğŸ›£ï¸ Freeway:</strong> Top level. Blue-grey pavement.</li>
            <li><strong>â¤´ï¸ Ramp:</strong> White pavement. Merges visually on top of Freeways.</li>
            <li><strong>ğŸŒ‰ Bridge Mode:</strong> Select a road and click "Make Bridge" to raise it above ground traffic.</li>
        </ul>

        <h4>3. Edit Tools</h4>
        <ul>
            <li><strong>Naming:</strong> Type in the top box to name your city.</li>
            <li><strong>Save/Load:</strong> Saves as .geojson. Auto-renames file based on city name.</li>
            <li><strong>History:</strong> Use Undo/Redo buttons or Ctrl+Z / Ctrl+Y.</li>
        </ul>
    </div>

    <div id="map"></div>
</div>

<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script src="js/layers.js"></script>
<script src="js/app.js"></script>

</body>
</html>