<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>MapMaker</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    
    <script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" type="text/css" />
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div id="sidebar">
    <h2 style="margin:0; color:white;">MapMaker</h2>
    <p style="color:#bdc3c7; font-size:12px; margin-bottom:15px;">v0.1b</p>
    
    <button class="btn-undo" onclick="undo()"><span>â†©ï¸</span> Undo</button>
    <div style="height:10px;"></div>

    <button class="btn-select" onclick="enterSelectMode()"><span>ğŸ‘†</span> Select / Edit</button>
    <button class="btn-label" onclick="activateLabelTool()"><span>ğŸ“</span> Place Label</button>

    <div id="road-controls" class="context-menu">
        <div class="control-label">Road Options</div>
        <button id="btn-curve-toggle" class="btn-mini btn-wide btn-curve" onclick="toggleLineSmoothing()">ã€°ï¸ Make Smooth</button>
    </div>

    <div id="text-controls" class="context-menu">
        <div class="control-label">Move</div>
        <div class="control-row">
            <button class="btn-mini" onclick="nudgeLabel(0, -5)">â¬†ï¸</button>
        </div>
        <div class="control-row">
            <button class="btn-mini" onclick="nudgeLabel(-5, 0)">â¬…ï¸</button>
            <button class="btn-mini" onclick="nudgeLabel(0, 5)">â¬‡ï¸</button>
            <button class="btn-mini" onclick="nudgeLabel(5, 0)">â¡ï¸</button>
        </div>
        <div class="control-label">Rotate</div>
        <div class="control-row">
            <button class="btn-mini" onclick="rotateLabel(-5)">â†º</button>
            <button class="btn-mini" onclick="rotateLabel(5)">â†»</button>
        </div>
        <div class="control-row">
            <button class="btn-mini btn-wide" onclick="editLabelText()">âœ Edit Text</button>
        </div>
    </div>

    <div style="height:10px;"></div>
    
    <button class="btn-freeway" onclick="startDrawing('freeway')"><span>ğŸ›£ï¸</span> Freeway</button>
    <button class="btn-ramp" onclick="startDrawing('ramp')"><span>â¤´ï¸</span> Ramp</button>
    <button class="btn-major" onclick="startDrawing('major')"><span>ğŸ™ï¸</span> Major Road</button>
    <button class="btn-minor" onclick="startDrawing('minor')"><span>ğŸ˜ï¸</span> Minor Street</button>
    
    <div class="toggle-container">
        <input type="checkbox" id="smooth-toggle" style="width:20px; height:20px;" checked>
        <label for="smooth-toggle">New: Auto-Smooth</label>
    </div>

    <button id="btn-delete" class="btn-delete" onclick="smartDelete()"><span>ğŸ—‘ï¸</span> Delete Selected</button>
    <button class="btn-help" onclick="toggleHelp()"><span>â“</span> Open User Guide</button>
    
    <div id="debug-info">Points: 0</div>
    <div style="flex-grow:1;"></div>

    <button class="btn-save" onclick="downloadMap()">ğŸ’¾ Save Map</button>
    <button class="btn-load" onclick="document.getElementById('file-input').click()">ğŸ“‚ Load Map</button>
    <input type="file" id="file-input" style="display:none" onchange="loadMap(this)" accept=".geojson,.json" />
</div>

<div id="main-content">
    <div id="help-panel">
        <button class="close-btn" onclick="toggleHelp()">âœ–</button>
        <h2>MapMaker Manual</h2>
        <h4>1. Road Hierarchy</h4>
        <ul>
            <li><strong>ğŸ›£ï¸ Freeway:</strong> Top layer. Thick slate-blue.</li>
            <li><strong>â¤´ï¸ Ramp:</strong> Middle layer. Connects Freeways.</li>
            <li><strong>ğŸ™ï¸ Major Road:</strong> Arterial layer. Wide white lines.</li>
            <li><strong>ğŸ˜ï¸ Minor Street:</strong> Bottom layer. Thin white lines.</li>
        </ul>
        <h4>2. Drawing & Smoothing</h4>
        <ul>
            <li><strong>Click</strong> to place points. <strong>Double-Click</strong> to finish.</li>
            <li><strong>Auto-Smooth:</strong> Checkbox controls default curve.</li>
            <li><strong>Manual Toggle:</strong> Use sidebar button to switch Smooth/Straight.</li>
        </ul>
        <h4>3. Editing</h4>
        <ul>
            <li><strong>Skeleton:</strong> Click road to see Red Dashed Line.</li>
            <li><strong>Edit:</strong> Drag White Dots to reshape.</li>
        </ul>
        <h4>4. Labels</h4>
        <ul>
            <li><strong>Anchor:</strong> Place near road to lock position.</li>
            <li><strong>Edit:</strong> Click label to Move/Rotate.</li>
        </ul>
    </div>

    <div id="map"></div>
</div>

<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script src="js/app.js"></script>

</body>
</html>