<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>MapMaker</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    
    <script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" type="text/css" />
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="sidebar">
        <input type="text" id="map-title" class="map-title-input" value="Untitled City" oninput="document.title = this.value">
        <p class="version-tag">v80: Compact UI</p>
        
        <div class="tool-grid">
            <button class="btn-undo btn-tool" onclick="undo()"><span>â†©ï¸</span> Undo</button>
            <button class="btn-redo btn-tool" onclick="redo()"><span>â†ªï¸</span> Redo</button>
        </div>
    
        <div class="section-header">Edit Tools</div>
        <div class="tool-grid">
            <button id="btn-select" class="btn-select btn-tool" onclick="enterSelectMode()"><span>ğŸ‘†</span> Select</button>
            <button id="btn-label" class="btn-label btn-tool" onclick="activateLabelTool()"><span>ğŸ“</span> Label</button>
        </div>
    
        <div id="road-controls" class="context-menu">
            <div class="control-label">Road Options</div>
            <button id="btn-curve-toggle" class="btn-mini btn-wide btn-curve" onclick="toggleLineSmoothing()">ã€°ï¸ Smooth</button>
            <div style="height:5px;"></div>
            <button id="btn-bridge-toggle" class="btn-mini btn-wide btn-bridge" onclick="toggleBridge()">ğŸŒ‰ Bridge</button>
        </div>
    
        <div id="text-controls" class="context-menu">
            <div class="control-label">Move Label</div>
            <div class="d-pad">
                <div class="d-pad-empty"></div>
                <button class="btn-mini" onclick="nudgeLabel(0, -5)">â¬†ï¸</button>
                <div class="d-pad-empty"></div>
                <button class="btn-mini" onclick="nudgeLabel(-5, 0)">â¬…ï¸</button>
                <button class="btn-mini" onclick="nudgeLabel(0, 5)">â¬‡ï¸</button>
                <button class="btn-mini" onclick="nudgeLabel(5, 0)">â¡ï¸</button>
            </div>
            <div class="control-row row-center">
                <button class="btn-mini" onclick="rotateLabel(-15)">â†º</button>
                <button class="btn-mini" onclick="rotateLabel(15)">â†»</button>
            </div>
            <button class="btn-mini btn-wide" onclick="editLabelText()">âœ Edit Text</button>
        </div>
    
        <div class="section-header">Roads</div>
        <div class="tool-grid">
            <button id="tool-freeway" class="btn-freeway btn-tool" onclick="startDrawing('freeway')"><span>ğŸ›£ï¸</span> Fwy</button>
            <button id="tool-ramp" class="btn-ramp btn-tool" onclick="startDrawing('ramp')"><span>â¤´ï¸</span> Ramp</button>
            <button id="tool-major" class="btn-major btn-tool" onclick="startDrawing('major')"><span>ğŸ™ï¸</span> Major</button>
            <button id="tool-minor" class="btn-minor btn-tool" onclick="startDrawing('minor')"><span>ğŸ˜ï¸</span> Minor</button>
        </div>
    
        <div class="toggle-group">
            <div class="toggle-item">
                <input type="checkbox" id="smooth-toggle" checked>
                <label for="smooth-toggle">Smooth</label>
            </div>
            <div style="width:1px; height:20px; background:#555;"></div> <div class="toggle-item">
                <input type="checkbox" id="snap-toggle" checked>
                <label for="snap-toggle">ğŸ§² Snap</label>
            </div>
        </div>
    
        <div class="section-header">System</div>
        <button id="btn-delete" class="btn-delete btn-tool" style="width:100%; margin-bottom:8px;" onclick="smartDelete()"><span>ğŸ—‘ï¸</span> Delete Selected</button>
        
        <div class="tool-grid">
            <button class="btn-save btn-tool" onclick="downloadMap()">ğŸ’¾ Save</button>
            <button class="btn-load btn-tool" onclick="document.getElementById('file-input').click()">ğŸ“‚ Load</button>
        </div>
        <button class="btn-help btn-tool" style="width:100%" onclick="toggleHelp()"><span>â“</span> Guide</button>
        
        <div id="debug-info">Points: 0</div>
        
        <input type="file" id="file-input" style="display:none" onchange="loadMap(this)" accept=".geojson,.json" />
    </div>

<div id="main-content">
    <div id="help-panel">
        <button class="close-btn" onclick="toggleHelp()">âœ–</button>
        <h2>MapMaker Guide</h2>
        <p style="color:#7f8c8d; font-size:12px;">v78 â€¢ Infrastructure Engine</p>

        <h4>1. Drawing & Snapping</h4>
        <ul>
            <li><strong>ğŸ§² Snap Toggle:</strong> When ON, road ends will magnetize to other roads (Green Flash).</li>
            <li><strong>Sticky Roads:</strong> Connected roads move together. Drag a parent road to move its children.</li>
            <li><strong>Split:</strong> Connecting to the middle of a road splits it into two segments.</li>
        </ul>

        <h4>2. Road Hierarchy</h4>
        <ul>
            <li><strong>ğŸ›£ï¸ Freeway:</strong> Top level. Blue-grey pavement.</li>
            <li><strong>â¤´ï¸ Ramp:</strong> White pavement. Merges visually on top of Freeways.</li>
            <li><strong>ğŸŒ‰ Bridge Mode:</strong> Select a road and click "Make Bridge" to raise it above ground traffic.</li>
        </ul>

        <h4>3. Edit Tools</h4>
        <ul>
            <li><strong>Naming:</strong> Type in the top box to name your city.</li>
            <li><strong>Save/Load:</strong> Saves as .geojson. Auto-renames file based on city name.</li>
            <li><strong>History:</strong> Use Undo/Redo buttons or Ctrl+Z / Ctrl+Y.</li>
        </ul>
    </div>

    <div id="map"></div>
</div>

<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script src="js/layers.js"></script>
<script src="js/app.js"></script>

</body>
</html>