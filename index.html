<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Map Maker</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    
    <script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" type="text/css" />
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div id="sidebar">
    <h2 style="margin:0; color:white;">Map Maker</h2>
    <p style="color:#bdc3c7; font-size:12px; margin-bottom:15px;">v60: Split Version</p>
    
    <button class="btn-undo" onclick="undo()"><span>â†©ï¸</span> Undo</button>
    <div style="height:10px;"></div>

    <button class="btn-select" onclick="enterSelectMode()"><span>ğŸ‘†</span> Select / Edit</button>
    <button class="btn-label" onclick="activateLabelTool()"><span>ğŸ“</span> Place Label</button>

    <div id="road-controls" class="context-menu">
        <div class="control-label">Road Options</div>
        <button id="btn-curve-toggle" class="btn-mini btn-wide btn-curve" onclick="toggleLineSmoothing()">ã€°ï¸ Make Smooth</button>
    </div>

    <div id="text-controls" class="context-menu">
        <div class="control-label">Move</div>
        <div class="control-row">
            <button class="btn-mini" onclick="nudgeLabel(0, -5)">â¬†ï¸</button>
        </div>
        <div class="control-row">
            <button class="btn-mini" onclick="nudgeLabel(-5, 0)">â¬…ï¸</button>
            <button class="btn-mini" onclick="nudgeLabel(0, 5)">â¬‡ï¸</button>
            <button class="btn-mini" onclick="nudgeLabel(5, 0)">â¡ï¸</button>
        </div>
        <div class="control-label">Rotate</div>
        <div class="control-row">
            <button class="btn-mini" onclick="rotateLabel(-5)">â†º</button>
            <button class="btn-mini" onclick="rotateLabel(5)">â†»</button>
        </div>
        <div class="control-row">
            <button class="btn-mini btn-wide" onclick="editLabelText()">âœ Edit Text</button>
        </div>
    </div>

    <div style="height:10px;"></div>
    
    <button class="btn-freeway" onclick="startDrawing('freeway')"><span>ğŸ›£ï¸</span> Freeway</button>
    <button class="btn-ramp" onclick="startDrawing('ramp')"><span>â¤´ï¸</span> Ramp</button>
    <button class="btn-major" onclick="startDrawing('major')"><span>ğŸ™ï¸</span> Major Road</button>
    <button class="btn-minor" onclick="startDrawing('minor')"><span>ğŸ˜ï¸</span> Minor Street</button>
    
    <div class="toggle-container">
        <input type="checkbox" id="smooth-toggle" style="width:20px; height:20px;" checked>
        <label for="smooth-toggle">Auto-Smooth</label>
    </div>

    <button id="btn-delete" class="btn-delete" onclick="smartDelete()"><span>ğŸ—‘ï¸</span> Delete Selected</button>
    <button class="btn-help" onclick="toggleHelp()"><span>â“</span> Open User Guide</button>
    
    <div id="debug-info">Points: 0</div>
    <div style="flex-grow:1;"></div>

    <button class="btn-save" onclick="downloadMap()">ğŸ’¾ Save Map</button>
    <button class="btn-load" onclick="document.getElementById('file-input').click()">ğŸ“‚ Load Map</button>
    <input type="file" id="file-input" style="display:none" onchange="loadMap(this)" accept=".geojson,.json" />
</div>

<div id="help-panel">
    <button class="close-btn" onclick="toggleHelp()">âœ–</button>
    <h2>Ghost City Manual</h2>
    
    <h4>1. Road Hierarchy</h4>
    <p style="font-size:13px; color:#666; margin-bottom:10px;">Roads automatically layer themselves:</p>
    <ul>
        <li><strong>ğŸ›£ï¸ Freeway:</strong> Top layer. Thick slate-blue. Use for interstates.</li>
        <li><strong>â¤´ï¸ Ramp:</strong> Middle layer. Connects Freeways to Streets. Borders blend with Freeways.</li>
        <li><strong>ğŸ™ï¸ Major Road:</strong> Arterial layer. Wide white lines.</li>
        <li><strong>ğŸ˜ï¸ Minor Street:</strong> Bottom layer. Thin white lines for neighborhoods.</li>
    </ul>

    <h4>2. Drawing & Smoothing</h4>
    <ul>
        <li><strong>Click</strong> to place points. <strong>Double-Click</strong> to finish a line.</li>
        <li><strong>Auto-Smooth:</strong> If checked (bottom left), new roads will curve automatically.</li>
        <li><strong>Manual Toggle:</strong> Select any existing road, then click the <strong>"Make Smooth / Straight"</strong> button in the sidebar to change its style.</li>
    </ul>

    <h4>3. The "Skeleton" Editing System</h4>
    <p style="font-size:13px; color:#666; margin-bottom:10px;">To keep editing fast, we separate the math from the visuals:</p>
    <ul>
        <li><strong>The Skin:</strong> The smooth road you see. You cannot click this directly.</li>
        <li><strong>The Skeleton:</strong> When you click a road, you see a <span style="color:red; font-weight:bold;">Red Dashed Line</span>. This is the editable skeleton.</li>
        <li><strong>How to Edit:</strong> Drag the <strong>White Dots</strong> on the red skeleton. The smooth skin will instantly update to follow you.</li>
    </ul>

    <h4>4. Smart Labels</h4>
    <ul>
        <li>Click <strong>ğŸ“ Place Label</strong> and click the map.</li>
        <li><strong>Magnetic Anchors:</strong> If you place a label within ~50m of a road, it locks to that road. If you move the road later, the label follows automatically.</li>
        <li><strong>Fine Tuning:</strong> Select a label to see the <strong>Move</strong> and <strong>Rotate</strong> controls in the sidebar.</li>
    </ul>

    <h4>5. Shortcuts & Cleanup</h4>
    <ul>
        <li><strong>Undo:</strong> Press <code style="background:#eee; padding:2px 4px; border-radius:3px;">Ctrl+Z</code> or use the top button.</li>
        <li><strong>Smart Delete:</strong>
            <ul style="margin-top:5px;">
                <li>Select a <strong>Road</strong> â†’ Deletes the whole road.</li>
                <li>Select a <strong>Point</strong> (Red) â†’ Deletes just that corner.</li>
            </ul>
        </li>
        <li><strong>Navigation:</strong> Right-Click + Drag to tilt/rotate the camera into 3D.</li>
    </ul>
</div>

<div id="map"></div>

<script src="js/config.js"></script> <script src="js/utils.js"></script>  <script src="js/app.js"></script>    </body>
</html>